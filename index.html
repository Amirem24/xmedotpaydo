<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paydo | پیدا</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#5b73e8">
    <link rel="icon" type="image/png" href="icon.png">
    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen">
    <div class="loading-logo"></div>
    <div class="loading-bar-container">
        <div class="loading-bar" id="loading-bar"></div>
    </div>
    <div class="loading-text" id="loading-text">در حال راه‌اندازی Paydo...</div>
</div>

<!-- ONBOARDING SCREEN -->
<div id="onboarding-screen" style="display: none;">
    <div class="onboard-slide active" id="slide-welcome">
        <div class="onboard-content-center">
            <div style="font-size: 18px; opacity: 0.8; margin-bottom: 10px;">خوش اومدی به</div>
            <div class="logo" style="font-size: 40px; margin-bottom: 60px; display:inline-block;">paydo</div>
            <div class="onboard-features">
                <div class="onboard-item">
                    <div class="onboard-icon" style="color:#ffab40"><i class="material-icons">bar_chart</i></div>
                    <div class="onboard-text">
                        <h4>نمایش نمودار دخل‌وخرج</h4>
                        <p>خرج این ماه رو با ماه‌های قبل مقایسه کن</p>
                    </div>
                </div>
                <div class="onboard-item">
                    <div class="onboard-icon" style="color:#ff4081"><i class="material-icons">pie_chart</i></div>
                    <div class="onboard-text">
                        <h4>مشاهده خرج هر دسته‌بندی</h4>
                        <p>سهم هر دسته‌بندی رو در دخل‌وخرج‌ها ببین</p>
                    </div>
                </div>
                <div class="onboard-item">
                    <div class="onboard-icon" style="color:#40c4ff"><i class="material-icons">touch_app</i></div>
                    <div class="onboard-text">
                        <h4>ثبت تراکنش با یک کلیک</h4>
                        <p>با یک کلیک، تراکنش‌های بانکی رو ثبت کن</p>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn-primary" onclick="nextOnboarding()">شروع</button>
    </div>
    <div class="onboard-slide" id="slide-setup">
        <div class="onboard-content-top">
            <div style="font-size: 24px; font-weight: 800; margin-bottom: 10px;">حساب‌کتاب‌ها</div>
            <p style="text-align:center; font-size:13px; opacity:0.7; margin-bottom: 30px; line-height:1.6;">همه حساب‌کتاب‌هات رو (بانکی و غیربانکی)<br>یکجا در Paydo ثبت کن!</p>
            <div id="onboard-accounts-list" class="onboard-list"></div>
            <button class="btn-secondary" onclick="openAddAccountModal()" style="width:100%; margin-top:10px;"><i class="material-icons">add</i> افزودن حساب‌کتاب جدید</button>
        </div>
        <div style="width:100%">
            <button class="btn-primary" onclick="finishOnboarding()">بزن بریم!</button>
            <div style="text-align:center; margin-top:15px; font-size:13px; opacity:0.5; cursor:pointer;" onclick="prevOnboarding()">صفحه قبل</div>
        </div>
    </div>
</div>

<div class="app-container" id="app-container">
    <header>
        <div class="logo">paydo</div>
    </header>

    <main id="main-content">
        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view-section active">
            <div class="balance-card">
                <div class="balance-label">موجودی کل</div>
                <div class="balance-amount" id="total-balance">۰ <span class="currency">تومان</span></div>
            </div>
            <div class="section-title"><span>حساب‌های من</span></div>
            <div class="accounts-scroll" id="accounts-container"></div>
            <div class="section-title">
                <span>تراکنش‌های اخیر</span>
                <span class="see-all" onclick="switchView('history')">مشاهده همه</span>
            </div>
            <div class="transactions-list dashboard-list" id="recent-transactions"></div>
        </div>

        <!-- TOOLS VIEW -->
        <div id="view-tools" class="view-section">
            <div class="section-title" style="margin-top: 10px;">ابزارها</div>
            
            <div class="settings-group">
                <div class="settings-item" onclick="switchView('report')" style="cursor: pointer; margin-bottom: 0;">
                    <div class="settings-icon" style="color:#00e676"><i class="material-icons">description</i></div>
                    <div class="settings-info">
                        <h4>دریافت گزارش</h4>
                        <p>دانلود فایل PDF ریز کارکرد و تحلیل حساب</p>
                    </div>
                    <i class="material-icons" style="margin-right:auto; color:rgba(255,255,255,0.5)">chevron_left</i>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-item" onclick="switchView('assets')" style="cursor: pointer; margin-bottom: 0;">
                    <div class="settings-icon" style="color:#ffca28"><i class="material-icons">monetization_on</i></div>
                    <div class="settings-info">
                        <h4>سبد دارایی</h4>
                        <p>مدیریت دارایی‌های غیرنقدی (طلا، ارز، سهام)</p>
                    </div>
                    <i class="material-icons" style="margin-right:auto; color:rgba(255,255,255,0.5)">chevron_left</i>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-item" onclick="switchView('loans')" style="cursor: pointer; margin-bottom: 0;">
                    <div class="settings-icon" style="color:#ff5252"><i class="material-icons">account_balance</i></div>
                    <div class="settings-info">
                        <h4>وام من</h4>
                        <p>مدیریت اقساط، یادآوری و وضعیت پرداخت</p>
                    </div>
                    <i class="material-icons" style="margin-right:auto; color:rgba(255,255,255,0.5)">chevron_left</i>
                </div>
            </div>
        </div>

        <!-- REPORT VIEW (NEW Full Page) -->
        <div id="view-report" class="view-section">
            <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('tools')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>بازگشت به ابزارها</span>
                </div>
            </div>

            <div class="balance-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <div class="balance-label">تنظیمات گزارش</div>
                <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">بازه زمانی مورد نظر را انتخاب کنید</div>
            </div>

            <div class="settings-group">
                <div style="margin-bottom: 20px;">
                    <label class="form-label" style="text-align: center; margin-bottom: 10px;">از تاریخ</label>
                    <div class="date-picker-row">
                        <input type="number" id="rep-start-year" class="form-input date-input" placeholder="1403">
                        <span style="font-size: 20px; opacity: 0.5;">/</span>
                        <input type="number" id="rep-start-month" class="form-input date-input" placeholder="01">
                        <span style="font-size: 20px; opacity: 0.5;">/</span>
                        <input type="number" id="rep-start-day" class="form-input date-input" placeholder="01">
                        <div class="date-icon"><i class="material-icons">event</i></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label class="form-label" style="text-align: center; margin-bottom: 10px;">تا تاریخ</label>
                    <div class="date-picker-row">
                        <input type="number" id="rep-end-year" class="form-input date-input" placeholder="1403">
                        <span style="font-size: 20px; opacity: 0.5;">/</span>
                        <input type="number" id="rep-end-month" class="form-input date-input" placeholder="10">
                        <span style="font-size: 20px; opacity: 0.5;">/</span>
                        <input type="number" id="rep-end-day" class="form-input date-input" placeholder="30">
                        <div class="date-icon"><i class="material-icons">event</i></div>
                    </div>
                </div>

                <div class="quick-dates">
                    <div class="quick-date-btn" onclick="setReportDate('thisMonth')">همین ماه</div>
                    <div class="quick-date-btn" onclick="setReportDate('lastMonth')">ماه گذشته</div>
                </div>

                <button class="btn-primary" onclick="generateReport()">دانلود فایل PDF</button>
            </div>
        </div>

        <!-- ASSETS VIEW -->
        <div id="view-assets" class="view-section">
            <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('tools')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>بازگشت به ابزارها</span>
                </div>
            </div>
            <div class="balance-card" style="background: linear-gradient(135deg, #2b32b2 0%, #1488cc 100%);">
                <div class="balance-label">ارزش کل دارایی‌های غیرنقدی</div>
                <div class="balance-amount" id="total-assets-value">۰ <span class="currency">تومان</span></div>
                <div style="font-size: 11px; opacity: 0.7; margin-top: 10px;">* این مبلغ در موجودی کل حساب‌ها محاسبه نمی‌شود</div>
            </div>
            <div class="section-title" style="justify-content: flex-end;">
                <button onclick="openAddAssetModal()" style="background:none; border:none; color:#fff; cursor:pointer; font-family: inherit;">
                    <i class="material-icons" style="vertical-align: middle;">add_circle_outline</i> افزودن دارایی
                </button>
            </div>
            <div id="assets-list-container"></div>
        </div>

        <!-- LOANS LIST VIEW -->
        <div id="view-loans" class="view-section">
            <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('tools')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>بازگشت به ابزارها</span>
                </div>
            </div>
            
            <div id="loans-list-container" style="display: flex; flex-direction: column; gap: 15px;"></div>
            
            <button class="fab-add-float" onclick="openAddLoanModal()">
                <i class="material-icons">add</i>
            </button>
        </div>

        <!-- LOAN DETAILS VIEW -->
        <div id="view-loan-details" class="view-section">
            <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('loans')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>لیست وام‌ها</span>
                </div>
                 <div style="margin-right: auto;">
                    <i class="material-icons" onclick="openEditLoanMainModal()" style="cursor:pointer; padding:5px;">edit</i>
                </div>
            </div>

            <!-- Loan Summary Card -->
            <div class="loan-summary-card" id="loan-summary-card"></div>

            <div class="section-title" style="justify-content: space-between;">
                <span>لیست اقساط</span>
                <!-- Corrected Font for Button -->
                <button class="btn-text-action" onclick="openAddInstallmentModal()">+ افزودن قسط</button>
            </div>
            <div class="timeline-container" id="loan-timeline"></div>
            
            <button class="btn-danger-outline" id="btn-delete-loan" style="margin-top: 30px; margin-bottom: 20px;">
                <i class="material-icons">delete</i> حذف این وام
            </button>
        </div>

        <!-- HISTORY VIEW -->
        <div id="view-history" class="view-section">
            <div class="section-title" style="margin-top: 10px;">گزارشات</div>
            <div class="budget-entry-btn" onclick="switchView('budget')">
                <div class="budget-icon-box"><i class="material-icons">bar_chart</i></div>
                <div style="flex:1">
                    <div style="font-weight: 700; font-size: 15px;">بودجه‌بندی و تحلیل</div>
                    <div style="font-size: 11px; opacity: 0.7;">مشاهده نمودار هزینه‌ها و درآمدها</div>
                </div>
                <i class="material-icons">chevron_left</i>
            </div>
            <div class="search-container">
                <i class="material-icons search-icon">search</i>
                <input type="text" class="search-input" placeholder="جستجو در تراکنش‌ها..." id="transaction-search">
            </div>
            <div class="transactions-list" id="all-transactions"></div>
        </div>

        <!-- BUDGET VIEW -->
        <div id="view-budget" class="view-section">
            <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('history')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>بازگشت به گزارشات</span>
                </div>
            </div>
            <div class="budget-header">
                <div class="budget-tabs">
                    <div class="budget-tab active" id="tab-budget-expense" onclick="setBudgetTab('expense')">هزینه‌ها</div>
                    <div class="budget-tab" id="tab-budget-income" onclick="setBudgetTab('income')">درآمدها</div>
                </div>
            </div>
            <div class="month-selector">
                <i class="material-icons" onclick="changeBudgetMonth(-1)">chevron_right</i>
                <span id="budget-month-label">...</span>
                <i class="material-icons" onclick="changeBudgetMonth(1)">chevron_left</i>
            </div>
            <div class="budget-summary">
                <div class="budget-total-amount" id="budget-total-amount">۰ ریال</div>
                <div class="budget-total-label" id="budget-total-label">مجموع هزینه ماه</div>
            </div>
            <div class="chart-container">
                <div class="chart-y-grid">
                    <div class="grid-line"><span></span></div>
                    <div class="grid-line"><span></span></div>
                    <div class="grid-line"><span></span></div>
                </div>
                <div class="chart-bars-area" id="chart-bars-area"></div>
                <div class="chart-x-labels"><span>۳۰</span><span>۲۲</span><span>۱۵</span><span>۸</span><span>۱</span></div>
                <div id="chart-tooltip" class="chart-tooltip"></div>
            </div>
            <div class="section-title" style="margin-top: 25px;">دسته‌بندی</div>
            <div id="budget-categories-list" class="budget-categories-list"></div>
        </div>

        <!-- ACCOUNTS LIST -->
        <div id="view-accounts" class="view-section">
             <div class="section-title" style="margin-top: 10px; cursor: pointer;" onclick="switchView('settings')">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="material-icons">arrow_forward</i>
                    <span>بازگشت به تنظیمات</span>
                </div>
            </div>
            <div class="section-title" style="margin-top: 10px; justify-content: flex-end; gap:10px;">
                <button onclick="openAddAccountModal()" style="background:none; border:none; color:#fff; cursor:pointer; font-family: inherit;">
                    <i class="material-icons" style="vertical-align: middle;">add_circle_outline</i> افزودن حساب
                </button>
            </div>
            <div id="accounts-list-full"></div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="view-settings" class="view-section">
            <div class="section-title" style="margin-top: 10px;">تنظیمات</div>
            
            <div class="settings-group">
                <div class="settings-header">حساب‌های بانکی و کیف پول</div>
                <div class="settings-item" onclick="switchView('accounts')" style="cursor: pointer;">
                    <div class="settings-icon" style="color:#40c4ff"><i class="material-icons">account_balance_wallet</i></div>
                    <div class="settings-info">
                        <h4>مدیریت حساب‌ها</h4>
                        <p>ویرایش، حذف و مشاهده موجودی حساب‌ها</p>
                    </div>
                    <i class="material-icons" style="margin-right:auto; color:rgba(255,255,255,0.5)">chevron_left</i>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-header">دسته بندی ها</div>
                <div class="settings-item" onclick="openCategoriesModal()" style="cursor: pointer;">
                    <div class="settings-icon"><i class="material-icons">label</i></div>
                    <div class="settings-info">
                        <h4>مدیریت دسته‌بندی‌ها</h4>
                        <p>مشاهده و حذف تگ‌های استفاده شده</p>
                    </div>
                    <i class="material-icons" style="margin-right:auto; color:rgba(255,255,255,0.5)">chevron_left</i>
                </div>
            </div>
            <div class="settings-group">
                <div class="settings-header">مدیریت حافظه</div>
                <div class="settings-item">
                    <div class="settings-icon"><i class="material-icons">storage</i></div>
                    <div class="settings-info">
                        <h4>وضعیت داده‌ها</h4>
                        <p id="storage-usage">در حال محاسبه...</p>
                    </div>
                </div>
                <button class="btn-danger-outline" onclick="resetAppData()">
                    <i class="material-icons">delete_forever</i> حذف کل اطلاعات (ریست فکتوری)
                </button>
            </div>
            <div class="settings-group">
                <div class="settings-header">مدیریت فایل پشتیبان</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-secondary" onclick="backupData()">
                        <i class="material-icons">cloud_download</i> بکاپ (دانلود)
                    </button>
                    <button class="btn-secondary" onclick="document.getElementById('restore-file').click()">
                        <i class="material-icons">cloud_upload</i> ریستور (آپلود)
                    </button>
                    <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreData(this)">
                </div>
            </div>
            <div class="settings-group">
                <div class="settings-header">به‌روزرسانی</div>
                <div class="settings-item">
                    <div class="settings-icon"><i class="material-icons">system_update</i></div>
                    <div class="settings-info">
                        <h4>نسخه برنامه</h4>
                        <p>v2.5.0 (Paydo)</p>
                    </div>
                </div>
                <button class="btn-primary-outline" onclick="checkForUpdate()">بررسی و دریافت نسخه جدید</button>
            </div>
            <div id="footer-branding" onclick="handleFooterClick()" style="text-align: center; color: rgba(255,255,255,0.3); font-size: 12px; margin-top: 20px; padding-bottom: 20px; cursor:pointer; user-select: none;">made with ❤️</div>
        </div>
    </main>

    <!-- FLOATING NAVIGATION BAR -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchView('dashboard')" id="nav-dashboard">
            <i class="material-icons">dashboard</i>
            <span>خانه</span>
        </div>
        <div class="nav-item" onclick="switchView('history')" id="nav-history">
            <i class="material-icons">assignment</i>
            <span>گزارش</span>
        </div>
        <div class="fab-add" onclick="openAddTransactionModal()">
            <i class="material-icons">add</i>
        </div>
        <div class="nav-item" onclick="switchView('tools')" id="nav-tools">
            <i class="material-icons">grid_view</i>
            <span>ابزار</span>
        </div>
        <div class="nav-item" onclick="switchView('settings')" id="nav-settings">
            <i class="material-icons">settings</i>
            <span>تنظیمات</span>
        </div>
    </nav>

    <!-- HIDDEN PDF GENERATION CONTAINER -->
    <div id="pdf-container" style="display: none;"></div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container"></div>

    <!-- MODALS -->
    <div class="modal-overlay" id="modal-confirm" style="z-index: 2000;">
        <div class="modal-content">
            <div class="modal-header"><h3 id="confirm-title">عنوان تایید</h3></div>
            <p id="confirm-message" style="color: rgba(255,255,255,0.8); line-height: 1.6;">متن پیام</p>
            <div class="confirm-actions">
                <button class="btn-confirm-yes" id="btn-confirm-yes">بله، مطمئنم</button>
                <button class="btn-confirm-no" onclick="closeModal('modal-confirm')">انصراف</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modal-logs" style="z-index: 9999;">
        <div class="modal-content" style="height: 90%; background: #1a1a24;">
            <div class="modal-header"><h3>System Logs</h3><button class="close-modal" onclick="closeModal('modal-logs')">&times;</button></div>
            <div id="log-container" class="log-terminal"></div>
            <button class="btn-secondary" onclick="copyLogs()" style="margin-top:10px;">کپی لاگ‌ها</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal-selection" style="z-index: 1500;">
        <div class="modal-content">
            <div class="modal-header"><h3 id="selection-title">انتخاب کنید</h3><button class="close-modal" onclick="closeModal('modal-selection')">&times;</button></div>
            <div class="selection-list" id="selection-list"></div>
        </div>
    </div>
    <div class="modal-overlay" id="modal-transaction">
        <div class="modal-content">
            <div class="modal-header"><h3>ثبت تراکنش جدید</h3><button class="close-modal" onclick="closeModal('modal-transaction')">&times;</button></div>
            <div class="type-selector">
                <div class="type-option selected" onclick="setTransType('expense')" id="opt-expense">هزینه</div>
                <div class="type-option" onclick="setTransType('income')" id="opt-income">درآمد</div>
                <div class="type-option" onclick="setTransType('transfer')" id="opt-transfer">انتقال</div>
            </div>
            <form id="form-transaction">
                <div class="form-group"><label class="form-label">مبلغ (تومان)</label><input type="text" inputmode="numeric" id="trans-amount" class="form-input money-input" placeholder="۰" required></div>
                <div class="form-group"><label class="form-label">عنوان</label><input type="text" id="trans-title" class="form-input" placeholder="مثلا: خرید نان" required></div>
                <div class="form-group"><label class="form-label">دسته بندی (تگ)</label><input type="text" id="trans-tags" class="form-input" placeholder="مثلا: خانه (با فاصله جدا کنید)"><div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 5px;">حداکثر ۳ تگ. در صورت خالی بودن، #سایر ثبت می‌شود.</div></div>
                <div class="form-group"><label class="form-label">حساب مبدا</label><input type="hidden" id="trans-account"><div class="form-input select-trigger" id="trigger-trans-account" onclick="openAccountSelect('trans-account', 'انتخاب حساب مبدا')">انتخاب کنید...</div></div>
                <div class="form-group" id="target-account-group" style="display:none;"><label class="form-label">حساب مقصد</label><input type="hidden" id="trans-target-account"><div class="form-input select-trigger" id="trigger-trans-target-account" onclick="openAccountSelect('trans-target-account', 'انتخاب حساب مقصد')">انتخاب کنید...</div></div>
                <button type="submit" class="btn-primary">ثبت تراکنش</button>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="modal-categories">
        <div class="modal-content" style="height: 80%;">
            <div class="modal-header"><h3>دسته بندی ها</h3><button class="close-modal" onclick="closeModal('modal-categories')">&times;</button></div>
            <div id="categories-list" style="padding-bottom: 20px;"></div>
        </div>
    </div>
    <div class="modal-overlay" id="modal-account">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-account-title">افزودن حساب جدید</h3><button class="close-modal" onclick="closeModal('modal-account')">&times;</button></div>
            <form id="form-account">
                <div class="form-group"><label class="form-label">نام حساب / کارت</label><input type="text" id="acc-name" class="form-input" placeholder="مثلا: بانک صادرات" required></div>
                <div class="form-group"><label class="form-label">موجودی فعلی (تومان)</label><input type="text" inputmode="numeric" id="acc-balance" class="form-input money-input" placeholder="۰" value="۰"></div>
                <div class="form-group"><label class="form-label">نوع حساب</label><input type="hidden" id="acc-type" value="card"><div class="form-input select-trigger" id="trigger-acc-type" onclick="openTypeSelect()">کارت بانکی</div></div>
                <button type="submit" class="btn-primary" id="btn-save-account">ذخیره حساب</button>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="modal-asset">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-asset-title">افزودن دارایی</h3><button class="close-modal" onclick="closeModal('modal-asset')">&times;</button></div>
            <form id="form-asset">
                <div class="form-group"><label class="form-label">نام دارایی</label><input type="text" id="asset-name" class="form-input" placeholder="مثلا: سکه طلا، دلار، بیت‌کوین" required></div>
                <div class="form-group"><label class="form-label">ارزش نقدی فعلی (تومان)</label><input type="text" inputmode="numeric" id="asset-value" class="form-input money-input" placeholder="۰" required></div>
                <button type="submit" class="btn-primary" id="btn-save-asset">ذخیره دارایی</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="modal-loan">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-loan-title">افزودن وام جدید</h3><button class="close-modal" onclick="closeModal('modal-loan')">&times;</button></div>
            <form id="form-loan">
                <div class="form-group">
                    <label class="form-label">نام بانک / عنوان وام</label>
                    <input type="text" id="loan-bank" class="form-input" placeholder="مثلا: بانک ملت - وام خودرو" required>
                </div>
                <div class="form-group">
                    <label class="form-label">مبلغ کل بازپرداخت (اصل + سود)</label>
                    <input type="text" inputmode="numeric" id="loan-total" class="form-input money-input" placeholder="۰" required>
                </div>
                <div class="form-group" style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label class="form-label">تعداد اقساط</label>
                        <input type="number" id="loan-count" class="form-input" placeholder="مثلا: 12" required>
                    </div>
                    <div style="flex:1.5;">
                         <label class="form-label">شروع (سال/ماه/روز)</label>
                         <div style="display:flex; gap:5px;">
                            <input type="number" id="loan-start-year" class="form-input" placeholder="1403" style="text-align:center;" value="1403">
                            <input type="number" id="loan-start-month" class="form-input" placeholder="01" style="text-align:center;">
                            <input type="number" id="loan-start-day" class="form-input" placeholder="01" style="text-align:center;">
                         </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">مبلغ هر قسط (تومان)</label>
                    <input type="text" inputmode="numeric" id="loan-installment-amount" class="form-input money-input" placeholder="محاسبه خودکار..." required>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 5px;">می‌توانید مبلغ محاسبه شده را تغییر دهید.</div>
                </div>
                <button type="submit" class="btn-primary" id="btn-save-loan">ایجاد وام</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="modal-edit-loan-main">
        <div class="modal-content">
            <div class="modal-header"><h3>ویرایش اطلاعات وام</h3><button class="close-modal" onclick="closeModal('modal-edit-loan-main')">&times;</button></div>
            <form id="form-edit-loan-main">
                <div class="form-group">
                    <label class="form-label">نام بانک / عنوان وام</label>
                    <input type="text" id="edit-loan-bank" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">مبلغ کل بازپرداخت (نمایشی)</label>
                    <input type="text" inputmode="numeric" id="edit-loan-total" class="form-input money-input" required>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 5px;">تغییر این مبلغ تاثیری روی مبلغ اقساط ندارد.</div>
                </div>
                <button type="submit" class="btn-primary">ذخیره تغییرات</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="modal-edit-installment">
        <div class="modal-content">
            <div class="modal-header"><h3>مدیریت قسط</h3><button class="close-modal" onclick="closeModal('modal-edit-installment')">&times;</button></div>
            <form id="form-edit-installment">
                <input type="hidden" id="edit-inst-index">
                <div class="form-group">
                    <label class="form-label">تاریخ قسط (سال/ماه/روز)</label>
                    <div style="display:flex; gap:5px;">
                        <input type="number" id="edit-inst-year" class="form-input" style="text-align:center;">
                        <input type="number" id="edit-inst-month" class="form-input" style="text-align:center;">
                        <input type="number" id="edit-inst-day" class="form-input" style="text-align:center;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">مبلغ قسط (تومان)</label>
                    <input type="text" inputmode="numeric" id="edit-inst-amount" class="form-input money-input">
                </div>
                <div style="display: flex; gap:10px; margin-top: 20px;">
                    <button type="submit" class="btn-primary">ذخیره تغییرات</button>
                    <button type="button" class="btn-danger-outline" onclick="deleteCurrentInstallment()">حذف قسط</button>
                </div>
            </form>
        </div>
    </div>

</div>

<script src="script.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>
